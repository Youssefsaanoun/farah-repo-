import{E as a,I as l,M as o,Qb as e,Rb as p,e as n,ja as c}from"./chunk-OXYRPRF3.js";var u=class s{constructor(t,r){this.http=t;this.platformId=r;if(e(this.platformId)){let i=localStorage.getItem("currentUser"),h=localStorage.getItem("authToken");if(i)try{this.currentUserSubject.next(JSON.parse(i)),this.currentUser=JSON.parse(i)}catch(m){console.error(m),this.logout()}}}apiUrl="http://localhost:8081/api/users";currentUser=null;currentUserSubject=new n(null);currentUser$=this.currentUserSubject.asObservable();register(t){return this.http.post(`${this.apiUrl}/register`,t)}login(t){return this.http.post(`${this.apiUrl}/login`,t).pipe(a(r=>{r&&r.token&&this.setSession(r)}))}setSession(t){let r={id:t.id,email:t.email,firstName:t.firstName,lastName:t.lastName,role:t.role};this.currentUser=r,this.currentUserSubject.next(r),e(this.platformId)&&(localStorage.setItem("currentUser",JSON.stringify(r)),localStorage.setItem("authToken",t.token))}getToken(){return e(this.platformId)?localStorage.getItem("authToken"):null}setCurrentUser(t){this.currentUser=t,this.currentUserSubject.next(t),e(this.platformId)&&localStorage.setItem("currentUser",JSON.stringify(t))}getCurrentUser(){return this.currentUser}updateProfile(t,r){return this.http.put(`${this.apiUrl}/${t}`,r)}requestPasswordReset(t){return this.http.post(`${this.apiUrl}/forgot-password`,{email:t})}resetPassword(t,r){return this.http.post(`${this.apiUrl}/reset-password`,{email:t,newPassword:r})}isAdmin(){return this.getCurrentUser()?.role==="ADMIN"}logout(){this.currentUser=null,this.currentUserSubject.next(null),e(this.platformId)&&(localStorage.removeItem("currentUser"),localStorage.removeItem("authToken"))}static \u0275fac=function(r){return new(r||s)(o(p),o(c))};static \u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"})};export{u as a};
