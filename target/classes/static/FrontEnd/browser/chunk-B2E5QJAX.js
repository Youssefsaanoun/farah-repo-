import{b as w,d as I}from"./chunk-J25QG7CS.js";import{a as N}from"./chunk-6DTTBAPB.js";import{a as F}from"./chunk-BHV7ZWC6.js";import{a as k,b as s,c as U,d as z,g as D,h as V,i as j,j as q,k as A,l as R,m as T,r as G,t as B}from"./chunk-GGHP7TD5.js";import{$a as P,Ea as u,Gb as O,Hb as S,Ka as d,La as n,Ma as o,Mb as E,Na as m,S as h,Sa as x,T as v,Ta as g,Ua as b,bb as a,cb as f,ma as C,mb as M,nb as y,oa as l,va as p,za as _}from"./chunk-OXYRPRF3.js";import"./chunk-FDERIQAA.js";function Y(c,i){if(c&1&&(n(0,"option",22),a(1),o()),c&2){let e=i.$implicit;d("value",e.id),l(),f(e.name)}}function $(c,i){c&1&&(n(0,"span",23),a(1,"Glissez-d\xE9posez ou cliquez pour t\xE9l\xE9charger"),o())}function H(c,i){if(c&1){let e=x();n(0,"div",24),m(1,"img",25),M(2,"imageUrl"),n(3,"button",26),g("click",function(){h(e);let r=b();return v(r.imageUrl=null)}),m(4,"i",27),o()()}if(c&2){let e=b();l(),d("src",y(2,1,e.imageUrl),C)}}var Q=class c{constructor(i,e,t,r){this.fb=i;this.productService=e;this.router=t;this.route=r;this.productForm=this.fb.group({name:["",s.required],description:["",s.required],price:[0,[s.required,s.min(0)]],quantity:[100,[s.required,s.min(0)]],categoryId:["",s.required]})}productForm;isEditMode=!1;productId=null;defaultVariantId=null;categories=[];imageUrl=null;ngOnInit(){this.loadCategories(),this.route.paramMap.subscribe(i=>{let e=i.get("id");e&&(this.isEditMode=!0,this.productId=+e,this.loadProduct(this.productId))})}loadCategories(){this.productService.getAllCategories().subscribe(i=>this.categories=i)}loadProduct(i){this.productService.getProductById(i).subscribe(e=>{let t=0;e.variants&&e.variants.length>0&&(t=e.variants[0].stockQuantity||0,this.defaultVariantId=e.variants[0].id||null),this.productForm.patchValue({name:e.name,description:e.description,price:e.price,quantity:t,categoryId:e.category.id}),e.images&&e.images.length>0&&(this.imageUrl=e.images[0].imageUrl)})}onFileSelected(i){let e=i.target.files[0];if(e){let t=new FileReader;t.onload=r=>{this.imageUrl=r.target.result},t.readAsDataURL(e),this.productService.uploadImage(e).subscribe({next:r=>{this.imageUrl=r.url},error:r=>console.error("Upload failed",r)})}}onSubmit(){if(this.productForm.invalid)return;let i=this.productForm.value,e=Number(i.quantity);console.log("Submitting Product Data:",i),console.log("Quantity to save:",e);let t={size:"Standard",color:"Default",stockQuantity:e};this.defaultVariantId&&(t.id=this.defaultVariantId);let r={name:i.name,description:i.description,price:i.price,category:{id:i.categoryId},images:this.imageUrl?[{imageUrl:this.imageUrl,isCover:!0}]:[],variants:[t]};this.isEditMode&&this.productId?this.productService.updateProduct(this.productId,r).subscribe(()=>{this.router.navigate(["/products"])}):this.productService.createProduct(r).subscribe(()=>{this.router.navigate(["/products"])})}static \u0275fac=function(e){return new(e||c)(p(G),p(N),p(I),p(w))};static \u0275cmp=_({type:c,selectors:[["app-product-manage"]],decls:43,vars:13,consts:[[1,"page-container"],[1,"form-card","fade-in"],[1,"form-header"],[1,"product-form",3,"ngSubmit","formGroup"],[1,"form-group","full-width"],["type","text","formControlName","name","placeholder","ex. Robe de soir\xE9e en soie",1,"form-control"],["formControlName","description","rows","4","placeholder","D\xE9crivez le tissu, la coupe et le style...",1,"form-control"],[1,"form-row"],[1,"form-group"],[1,"input-wrapper"],["type","number","formControlName","price","placeholder","0.00",1,"form-control"],["type","number","formControlName","quantity","placeholder","100",1,"form-control"],["formControlName","categoryId",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[1,"form-group","full-width","upload-section"],[1,"file-drop-area"],["class","file-msg",4,"ngIf"],["type","file","accept","image/*",1,"file-input",3,"change"],["class","image-preview",4,"ngIf"],[1,"form-actions"],["type","submit",1,"btn","btn-primary","btn-submit",3,"disabled"],[1,"fas"],[3,"value"],[1,"file-msg"],[1,"image-preview"],["alt","Aper\xE7u",3,"src"],["type","button",1,"btn-remove-image",3,"click"],[1,"fas","fa-times"]],template:function(e,t){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),a(4),o(),n(5,"p"),a(6,"Entrez les d\xE9tails de votre article"),o()(),n(7,"form",3),g("ngSubmit",function(){return t.onSubmit()}),n(8,"div",4)(9,"label"),a(10,"Nom du produit"),o(),m(11,"input",5),o(),n(12,"div",4)(13,"label"),a(14,"Description"),o(),m(15,"textarea",6),o(),n(16,"div",7)(17,"div",8)(18,"label"),a(19,"Prix (TND)"),o(),n(20,"div",9),m(21,"input",10),o()(),n(22,"div",8)(23,"label"),a(24,"Quantit\xE9 en stock"),o(),m(25,"input",11),o(),n(26,"div",8)(27,"label"),a(28,"Cat\xE9gorie"),o(),n(29,"select",12),u(30,Y,2,2,"option",13),o()()(),n(31,"div",14)(32,"label"),a(33,"Image du produit"),o(),n(34,"div",15),u(35,$,2,0,"span",16),n(36,"input",17),g("change",function(L){return t.onFileSelected(L)}),o(),u(37,H,5,3,"div",18),o()(),n(38,"div",19)(39,"button",20),m(40,"i",21),n(41,"span"),a(42),o()()()()()()),e&2&&(l(4),f(t.isEditMode?"Modifier le produit":"Ajouter un nouveau produit"),l(3),d("formGroup",t.productForm),l(23),d("ngForOf",t.categories),l(5),d("ngIf",!t.imageUrl),l(2),d("ngIf",t.imageUrl),l(2),d("disabled",t.productForm.invalid),l(),P("fa-plus",!t.isEditMode)("fa-save",t.isEditMode)("icon-animated",!0),l(2),f(t.isEditMode?"Mettre \xE0 jour le produit":"Cr\xE9er le produit"))},dependencies:[E,O,S,B,D,R,T,k,V,A,U,z,q,j,F],styles:[".page-container[_ngcontent-%COMP%]{padding:4rem 1rem;min-height:80vh;display:flex;justify-content:center;align-items:flex-start}.form-card[_ngcontent-%COMP%]{background:#fff;width:100%;max-width:800px;border-radius:8px;box-shadow:0 10px 30px #0000000d;padding:3rem;overflow:hidden}.form-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:3rem}.form-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Playfair Display,serif;font-size:2.5rem;color:#1c1c1c;margin-bottom:.5rem}.form-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#777;font-size:1rem}.product-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.form-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}@media(max-width:768px){.form-row[_ngcontent-%COMP%]{grid-template-columns:1fr}}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.8rem;font-weight:700;text-transform:uppercase;letter-spacing:.05em;margin-bottom:.5rem;color:#555}.form-control[_ngcontent-%COMP%]{padding:1rem;border:1px solid #e0e0e0;border-radius:4px;font-family:Lato,sans-serif;font-size:1rem;transition:all .3s ease;background-color:#fafafa}.form-control[_ngcontent-%COMP%]:focus{border-color:#1c1c1c;background-color:#fff;box-shadow:0 0 0 3px #0000000d;outline:none}.form-control[_ngcontent-%COMP%]::placeholder{color:#ccc}textarea.form-control[_ngcontent-%COMP%]{resize:vertical;min-height:120px}.upload-section[_ngcontent-%COMP%]   .file-drop-area[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;width:100%;min-height:200px;border:2px dashed #ddd;border-radius:4px;transition:.2s;background-color:#fafafa}.upload-section[_ngcontent-%COMP%]   .file-drop-area[_ngcontent-%COMP%]:hover{background-color:#f0f0f0;border-color:#999}.upload-section[_ngcontent-%COMP%]   .file-msg[_ngcontent-%COMP%]{color:#777;font-weight:500}.upload-section[_ngcontent-%COMP%]   .file-input[_ngcontent-%COMP%]{position:absolute;left:0;top:0;height:100%;width:100%;cursor:pointer;opacity:0}.upload-section[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]{width:100%;height:100%;padding:1rem;display:flex;justify-content:center;align-items:center;position:relative}.upload-section[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:100%;max-height:300px;object-fit:contain;border-radius:4px;box-shadow:0 4px 10px #0000001a}.upload-section[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   .btn-remove-image[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;background:#0009;color:#fff;border:none;border-radius:50%;width:30px;height:30px;cursor:pointer;z-index:10;display:flex;align-items:center;justify-content:center;transition:background .2s}.upload-section[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   .btn-remove-image[_ngcontent-%COMP%]:hover{background:red}.form-actions[_ngcontent-%COMP%]{margin-top:1rem}.btn-submit[_ngcontent-%COMP%]{width:100%;padding:1.2rem;font-size:1rem;font-weight:700;letter-spacing:.1em;display:flex;justify-content:center;align-items:center;gap:10px;background-color:#1c1c1c;color:#fff;border:none;transition:transform .2s ease,box-shadow .2s ease}.btn-submit[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 20px #0003;background-color:#000}.btn-submit[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}"]})};export{Q as ProductManageComponent};
