import{E as a,I as l,M as o,Qb as e,Rb as p,Vb as u,e as n,ja as c}from"./chunk-MVKOQPDJ.js";var m=class s{constructor(r,t){this.http=r;this.platformId=t;if(e(this.platformId)){let i=localStorage.getItem("currentUser"),h=localStorage.getItem("authToken");if(i)try{this.currentUserSubject.next(JSON.parse(i)),this.currentUser=JSON.parse(i)}catch(U){console.error(U),this.logout()}}}apiUrl=`${u.apiUrl}/users`;currentUser=null;currentUserSubject=new n(null);currentUser$=this.currentUserSubject.asObservable();register(r){return this.http.post(`${this.apiUrl}/register`,r)}login(r){return this.http.post(`${this.apiUrl}/login`,r).pipe(a(t=>{t&&t.token&&this.setSession(t)}))}setSession(r){let t={id:r.id,email:r.email,firstName:r.firstName,lastName:r.lastName,role:r.role};this.currentUser=t,this.currentUserSubject.next(t),e(this.platformId)&&(localStorage.setItem("currentUser",JSON.stringify(t)),localStorage.setItem("authToken",r.token))}getToken(){return e(this.platformId)?localStorage.getItem("authToken"):null}setCurrentUser(r){this.currentUser=r,this.currentUserSubject.next(r),e(this.platformId)&&localStorage.setItem("currentUser",JSON.stringify(r))}getCurrentUser(){return this.currentUser}updateProfile(r,t){return this.http.put(`${this.apiUrl}/${r}`,t)}requestPasswordReset(r){return this.http.post(`${this.apiUrl}/forgot-password`,{email:r})}resetPassword(r,t){return this.http.post(`${this.apiUrl}/reset-password`,{email:r,newPassword:t})}isAdmin(){return this.getCurrentUser()?.role==="ADMIN"}logout(){this.currentUser=null,this.currentUserSubject.next(null),e(this.platformId)&&(localStorage.removeItem("currentUser"),localStorage.removeItem("authToken"))}static \u0275fac=function(t){return new(t||s)(o(p),o(c))};static \u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"})};export{m as a};
